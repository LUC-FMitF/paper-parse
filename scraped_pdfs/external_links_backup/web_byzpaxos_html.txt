Source URL: http://lamport.azurewebsites.net/tla/byzpaxos.html
Final URL: https://lamport.azurewebsites.net/tla/byzpaxos.html
================================================================================

<!DOCTYPE html>
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="GENERATOR" CONTENT="Mozilla/4.05 [en] (X11; I; OSF1 V4.0 alpha) 
              [Netscape]">

<!-- The following loads the style sheet for the html files of 
     the tla web site -->
<link rel="stylesheet" type="text/css" href="tlaweb.css">


<script src="tlaweb.js"> </script>


<title>Byzantine Paxos Proof</title> 

<!-- -->
<style>
h1 {line-height:38px;
    margin-top:16px
    }
</style>

</HEAD>

<BODY onload="initialize()">

<table id="main">
<tr>
<td id="main_leftcolumn" >
</td>

<td id="main_contentcolumn">

<table>
<tr >
<td style="vertical-alight:top">
<div id = "showleftcol" > </div> 

<H1>Mechanically Checked Safety Proof of a Byzantine Paxos Algorithm</H1>

<p style="margin-top:-8px; margin-bottom:-18px">
Leslie Lamport<p>
<font size=-1><I> Last modified on 25 July 2020</I></font>
</td>
<!-- td style="vertical-alight:top;width:auto" -->
<!-- img src="tla-logo.png" style="width:170px;margin-top:14px"> </img -->
<!-- /td -->
</tr>

</table>
<hr style="margin-bottom:-5px;margin-top:-11px"> 

<P style="margin-top:0px"> </P>

This web page links to the formal PlusCal specifications of the
algorithms, and the machine-checked TLA+ proofs of their correctness,
that are presented informally in the paper
 <a href="https://lamport.azurewebsites.net/pubs/pubs.html#web-byzpaxos">
  Byzantizing Paxos by Refinement</a>.&nbsp;
That paper describes an algorithm BPCon that abstracts and generalizes
the consensus algorithm at the heart of the 
algorithm described in the seminal paper
  <i>Practical Byzantine Fault Tolerance and Proactive Recovery</i>
by Miguel Castro and Barbara Liskov 
 (<i>ACM Transactions on Computer Systems 20, 4</i> (2002), 
    pages 398-461).&nbsp;

BPCon also admits two other implementations: a simple one
that employs digital signatures and a previously unpublished one that,
like the Castro-Liskov algorithm, relies only on message
authenticators.&nbsp;

It is derived by <q>Byzantizing</q> algorithm
PCon, a variant of the classic Paxos consensus algorithm
first published in 
  <i>The Part-Time Parliament</i> by Leslie Lamport,
  (<i>ACM Transactions on Computer Systems 16, 2</i> (1998), 
 pages 133-169).&nbsp;
(Paxos also appeared without proof in Brian Oki's Ph.D.
thesis.)&nbsp; Although never presented in this form, PCon was
essentially used as part of two previous algorithms:
  <a href="../pubs/vertical-paxos.pdf">Vertical Paxos</a> 
and an unpublished (but patented) version of 
  <a href="../pubs/web-dsn-submission.pdf">Cheap Paxos</a>.

<H2 id="h2what"  class="show-hide" 
    onclick="showHide('hide-what','what')"><a name="what">
What We've Done</a>
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <font id="hide-what" >
      [show]</font>
</H2>

<DIV id="what" class = "hidden-div">

We have proved the safety properties of algorithm BPCon by showing
that its safety specification refines (implements) that of algorithm
PCon. 
The proof has been checked by 
  <a href="https://tla.msr-inria.inria.fr/tlaps">TLAPS, 
  the TLA+ proof system</a>.&nbsp;
The initial version of the proof was written and checked in
2011.&nbsp; Since then, improvements to TLAPS have allowed the proof
to be shortened---mainly by Stephan Merz.

<!--
In
2014, the proof was shortened by using TLAPS's recently added SMT
(Satisfiability Modulo Theories) back-end prover.&nbsp;  

It's possible that changes to TLAPS may cause it to no longer verify
some of the proof steps.&nbsp; Such steps will have to be re-proved
by decomposing them into simpler steps.&nbsp;
-->

<p> 


We have also written the following two additional specifications.&nbsp;
<UL> <LI> Consensus:
   A trivial, high-level specification of consensus.
</LI>

<p>

<LI>Voting:
A high-level consensus algorithm that describes ballots and voting
that underlie the classic Paxos consensus algorithm.  
</LI> </UL> 

We have proved that the Voting algorithm refines the Consensus
specification (including liveness).&nbsp; The proofs of the safety
properties have been completely checked by TLAPS, but some steps in the
liveness proofs have not because TLAPS cannot yet check them.

<p>

Algorithm PCon refines the Voting algorithm.&nbsp; The safety part of
this refinement, as well as of the refinement of Consensus by Voting,
has been checked by the TLC model checker.



</DIV>

<H2 id="h2specs"  class="show-hide" 
    onclick="showHide('hide-specs','specs')">
  <a name="installing">The Specifications</a>
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <font id="hide-specs" >
      [show]</font>
</H2>


<DIV id="specs" class = "hidden-div">

<!--
The files listed below are the ones contain the versions of that
existed when the paper was published in 2011.  They are maintained
here for consistency with what is described in the paper.  Probably
quite a few of the proof steps will no longer be checked by the
current version of TLAPS. The proof has been improved since then,
mainly by Stephan Merz.  Improvements to TLAPS have allowed the proofs
to be simplified, and enhancements to it have made partial proofs of
liveness properties possible.

<p>

-->

Our specifications are all written as algorithms in the 

 <A href =
   "high-level-view.html?unhideBut=hide-pluscal&unhideDiv=pluscal&back-link=byzpaxos.html#specs?unhideBut@EQhide-specs@AMPunhideDiv@EQspecs"
  > PlusCal algorithm language</A>,

which are
automatically translated into TLA+.&nbsp;  
  <a href="pluscal-code.pdf">Click here</a> for an
explanation of the PlusCal code.

This code, and its translation, specify only safety.&nbsp;  The liveness
properties of specifications Consensus and Voting are written directly
in TLA+.&nbsp;  (Constructs for specifying liveness were added to PlusCal
after these specifications were written, but they are not general
enough to specify the rather subtle liveness assumptions needed by the
algorithms.)&nbsp;  We have not written formal liveness properties for BPCon
and PCon.&nbsp;  The specifications and their pretty-printed
versions are in the following files.


<table style="margin-left:55px;margin-top:5px;margin-bottom:10px">

<tr style="height:35px"><td><b>Consensus</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
    <td><a href="Consensus.tla">Consensus.tla</a>
</td>
    <td><a href="Consensus.pdf">Consensus.pdf</a></td>
</tr>

<tr style="height:35px"><td><b>Voting </b>&nbsp; </td>

<td ><a href="VoteProof.tla">VoteProof.tla</a></td>
<td><a href="VoteProof.pdf">Voteproof.pdf</a>.</td>
</tr>


<tr style="height:35px">
<td ><b>PCon</b> &nbsp; </td>
<td><a href="PConProof.tla">PConProof.tla</a></td>
<td><a href="PConProof.pdf">PConProof.pdf</a></td>
</tr>

<tr style="height:35px">
<td><b>BPCon</b> &nbsp; </td>
<td><a href="BPConProof.tla">BPConProof.tla</a>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td><a href="BPConProof.pdf">BPConProof.pdf</a></td>
</tr>
</table>

They are also all in <a href="ByzantinePaxos.zip">this
compressed zip file</a>.
 <p>

All the specifications have extensive comments.&nbsp;  If you are interested
primarily in the specifications and proofs, then you should read them
in order, starting with the Consensus specification.&nbsp;  If you are
primarily interested in Byzantine Paxos, unless you are already
familiar with TLA+ and PlusCal, you should still read the Consensus
specification first.&nbsp;  You might then want to go directly to BPConProof
and refer back to the other specifications as needed.



</DIV>

<H2 id="h2verifying"  class="show-hide" 
    onclick="showHide('hide-verifying','verifying')">
  <a name="problem">Verifying the Refinements</a>
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
     <font id="hide-verifying" >
      [show]</font>
</H2>

<DIV id="verifying" class = "hidden-div">

Each algorithm refines (implements) the previous one under a suitable
<A href = 
  "/pubs/pubs.html#abadi-existence">
refinement mapping</A>.&nbsp;  Before attempting any proofs, we checked the
safety part of each refinement except the last with the <a
href="tlc.html">TLC model checker</a>, using large enough models that
we felt confident that there were no <q>coding</q> errors.&nbsp;  Our
understanding of these algorithms is good enough that we were
confident that they were basically correct before writing any proofs.&nbsp;
We also model checked BPCon to find simple errors, but TLC cannot
check it on large enough models to give any confidence in correctness
of the algorithm.

<p>

The final refinement step, that BPCon refines PCon, has
been proved and the proof completely checked by TLAPS, except that
a few simple mathematical facts about finite sets are
assumed without proof--for example, that a finite, non-empty set of integers
contains a maximal element.&nbsp;  These assumptions were checked with
TLC to avoid possible errors in their statements.&nbsp;
Theorems in library modules developed since the proofs were written would 
now make it easy to prove those statements.

<p>


We have written a proof of the first refinement step, that Voting
refines Consensus, including the liveness properties.&nbsp; All safety
properties were completely checked, except that we assumed a few of
the same kind of simple mathematical facts as in the refinement proof
of BPCon, where possible checking them with TLC.&nbsp;
It would be nice to complete the entire refinement sequence by
proving that PCon refines the safety part of the
Voting spec.&nbsp;  However, there is little 
motivation to do that because: (i)&nbsp;we already believe
that PCon is correct, (ii)&nbsp;its proof would be less of a test
of our ability to write and machine check such proofs than the
refinement proof of BPCon, and (iii)&nbsp;a proof of correctness
of ordinary Paxos has already been written and checked with TLAPS.

<p>

The proof that the Voting spec implements the liveness property of
Consensus has not been completely checked, since TLAPS cannot yet
reason about TLA's ENABLED operator or do non-propositional temporal
logic reasoning.&nbsp;  
</DIV>

<hr>
<small > 

<p style="line-height:18px"> 
This page can be found by searching the Web for the 23-letter 
string
  <tt>uidlamportbyzpaxosproof</tt>.&nbsp;
Please do not put this string in any document that could wind up on
the web--including email messages and Postscript and Word documents.&nbsp;
You can refer to it in Web documents as <q>the string obtained by
removing the <tt>-</tt> from
  <tt>uid-lamportbyzpaxosproof</tt></q>.
</p>
</small>

<!-- **************** BEGINNING OF ENDING BOILERPLATE *************** -->

</td>
</tr>
<!-- Bottom Back button may need to adjust margin-top parameter -->
<tr>
<td> 
<a class="back-link" style="display:none" href="">
<p style="margin-top:-27px"><b>Back</b>
</p>
</a>

<!-- For a long page, add more back buttons higher on the page
   by add one or more items like this, adjusting the margin-top 
   parameter as desired.

   <a class="back-link" style="display:none" href="">
   <p style="margin-top:-1100px"><b>Back</b> </p> </a>
-->

</td>
</tr>

</table>


</BODY>
</HTML>

